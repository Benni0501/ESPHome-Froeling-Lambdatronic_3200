esphome:
  name: wemos-d1-froeling
  friendly_name: wemos-d1-froeling

esp8266:
  board: d1_mini

# Enable logging
logger:
  level: INFO

# Enable Home Assistant API
api:
  encryption:
    key: ""

ota:
  password: ""

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

web_server:
  port: 80

substitutions:
  name: froeling
  modbus_controller_id: froeling

uart:
  - id: uartfroeling
    tx_pin: 15
    rx_pin: 13
    baud_rate: 57600
    data_bits: 8
    stop_bits: 1
    parity: NONE
    #debug:

modbus:
  id: modbus1
  uart_id: uartfroeling

modbus_controller:
  - id: froeling
    address: 2
    modbus_id: modbus1
    setup_priority: -10
    update_interval: "8s"
    command_throttle: "50ms"

globals:
  - id: debug_address
    type: int
    restore_value: yes
    initial_value: '0'

switch:
  - platform: restart
    name: "Restart wemos-d1-froeling"

sensor:
  ##### Kessel #####
  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Kesseltemperatur"
    id:  ${name}_Kesseltemperatur
    register_type: read
    address: 0
    unit_of_measurement: "°C"
    accuracy_decimals: 1
    value_type: U_WORD 
    filters:
      - multiply: 0.5

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Abgastemperatur"
    id:  ${name}_Abgastemperatur
    register_type: read
    address: 1
    unit_of_measurement: "°C"
    accuracy_decimals: 1
    value_type: U_WORD 
 
  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Verbleibende Heizstunden bis zur Asche entleeren Warnung"
    id:  ${name}_Verbleibende_Heizstunden_bis_zur_Asche_entleeren_Warnung
    register_type: read
    address: 86
    unit_of_measurement: "h"
    value_type: U_WORD

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Saugzug - Ansteuerung"
    id:  ${name}_Saugzug_Ansteuerung
    register_type: read
    address: 75
    unit_of_measurement: "%"
    value_type: U_WORD

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Restsauerstoffgehalt"
    id:  ${name}_Restsauerstoffgehalt
    register_type: read
    address: 3
    unit_of_measurement: "%"
    accuracy_decimals: 1
    value_type: U_WORD
    filters:
      - multiply: 0.1
  
  ##### Heizkörper HK1 #####
  # - platform: modbus_controller
  #   modbus_controller_id: ${modbus_controller_id}
  #   name: "${name}-HK1 - Vorlauf-Isttemperatur"
  #   id:  ${name}_HK1_Vorlauf_Isttemperatur
  #   register_type: read
  #   address: 1030
  #   unit_of_measurement: "°C"
  #   value_type: U_WORD
  #   filters:
  #     - multiply: 0.5

  # - platform: modbus_controller
  #   modbus_controller_id: ${modbus_controller_id}
  #   name: "${name}-HK1 - Vorlauf-Solltemperatur"
  #   id:  ${name}_HK1_Vorlauf_Solltemperatur
  #   register_type: read
  #   address: 1031
  #   unit_of_measurement: "°C"
  #   value_type: U_WORD
  #   filters:
  #     - multiply: 0.5

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Aussentemperatur"
    id:  ${name}_Aussentemperatur
    register_type: read
    address: 1000
    unit_of_measurement: "°C"
    value_type: U_WORD
    filters:
      - multiply: 0.5

  ##### Boiler 1 #####
  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Boiler 1 Temperatur oben"
    id:  ${name}_Boiler_1_Temperatur_oben
    register_type: read
    address: 1630
    unit_of_measurement: "°C"
    value_type: U_WORD
    filters:
      - multiply: 0.5

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Boiler 1 Pumpe Ansteuerung"
    id:  ${name}_Boiler_1_Pumpe_Ansteuerung
    register_type: read
    address: 1632
    unit_of_measurement: "%"
    value_type: U_WORD

  ##### Puffer 1 #####
  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Puffer 1 Temperatur oben"
    id:  ${name}_Puffer_1_Temperatur_oben
    register_type: read
    address: 2000
    unit_of_measurement: "°C"
    value_type: U_WORD  
    filters:
      - multiply: 0.5

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Puffer 1 Temperatur mitte"
    id:  ${name}_Puffer_1_Temperatur_mitte
    register_type: read
    address: 2001
    unit_of_measurement: "°C"
    value_type: U_WORD  
    filters:
      - multiply: 0.5

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Puffer 1 Temperatur unten"
    id:  ${name}_Puffer_1_Temperatur_unten
    register_type: read
    address: 2002
    unit_of_measurement: "°C"
    value_type: U_WORD  
    filters:
      - multiply: 0.5

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Puffer 1 Ladezustand"
    id:  ${name}_Puffer_1_Ladezustand
    register_type: read
    address: 2006
    unit_of_measurement: "%"
    value_type: U_WORD  

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Puffer 1 Pufferpumpen Ansteuerung"
    id:  ${name}_Puffer_1_Pufferpumpen_Ansteuerung
    register_type: read
    address: 2003
    unit_of_measurement: "%"
    value_type: U_WORD  

  ##### Austragung #####
  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Fuellstand im Pelletsbehaelter"
    id:  ${name}_Fuellstand_im_Pelletsbehaelter
    register_type: read
    address: 21
    unit_of_measurement: "%"
    accuracy_decimals: 1
    value_type: U_WORD
    filters:
      - multiply: 0.0048309178743961

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Resetierbarer kg-Zaehler"
    id:  ${name}_Resetierbarer_kg_Zaehler
    register_type: read
    address: 81
    unit_of_measurement: "kg"
    value_type: U_WORD

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Resetierbarer t-Zaehler"
    id:  ${name}_Resetierbarer_t_Zaehler
    register_type: read
    address: 82
    unit_of_measurement: "t"
    value_type: U_WORD

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Pelletverbrauch Gesamt"
    id:  ${name}_Pelletverbrauch_Gesamt
    register_type: read
    address: 83
    unit_of_measurement: "t"
    accuracy_decimals: 1
    value_type: U_WORD
    filters:
      - multiply: 0.1

  - platform: modbus_controller
    modbus_controller_id: ${modbus_controller_id}
    name: "${name}-Pelletlager Restbestand"
    id:  ${name}_Pelletlager_Restbestand
    register_type: holding
    address: 319
    unit_of_measurement: "t"
    accuracy_decimals: 1
    value_type: U_WORD
    filters:
      - multiply: 0.1
  
  ##### Zirkulations Pumpe #####
  # - platform: modbus_controller
  #   modbus_controller_id: ${modbus_controller_id}
  #   name: "${name}-Ruecklauftemperatur an der Zirkulations Leitung"
  #   id:  ${name}_Ruecklauftemperatur_an_der_Zirkulations_Leitung
  #   register_type: holding
  #   address: 711
  #   unit_of_measurement: "°C"
  #   value_type: U_WORD
  #   filters:
  #     - multiply: 0.5

  # - platform: modbus_controller
  #   modbus_controller_id: ${modbus_controller_id}
  #   name: "${name}-Drehzahl der Zirkulations Pumpe"
  #   id:  ${name}_Drehzahl_der_Zirkulations_Pumpe
  #   register_type: holding
  #   address: 710
  #   unit_of_measurement: "%"
  #   value_type: U_WORD
